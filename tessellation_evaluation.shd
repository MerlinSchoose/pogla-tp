#version 450

layout (quads, equal_spacing, ccw) in;

uniform float anim_time;
uniform mat4 view_matrix;
uniform mat4 model_matrix;
uniform mat4 projection_matrix;

out vec3 color;

/*mat4 model_view_matrix = mat4(
  0.57735, -0.33333, 0.57735, 0.00000,
  0.00000, 0.66667, 0.57735, 0.00000,
  -0.57735, -0.33333, 0.57735, 0.00000,
  0.00000, 0.00000, -17, 1.00000);*/

/*mat4 projection_matrix = mat4(
  250.00000, 0.00000, 0.00000, 0.00000,
  0.00000, 250.00000, 0.00000, 0.00000,
  0.00000, 0.00000, -1.02020, -10.10101,
  0.00000, 0.00000, -1.00100, 0.00000);*/

void main() {
  vec4 p1 = mix(gl_in[0].gl_Position, gl_in[1].gl_Position, gl_TessCoord.x);
  vec4 p2 = mix(gl_in[3].gl_Position, gl_in[2].gl_Position, gl_TessCoord.x);
  vec4 p = mix(p1, p2, gl_TessCoord.y);
  float time_regulator = 1.2f;
  float time = anim_time / time_regulator;

  p.y = sin(2.f * 3.14f * gl_TessCoord.x + time) / 10.0f;
  p.y += sin(2.f * 3.14f * gl_TessCoord.y + time + 0.2f) / 8.0f;

  color = vec3(gl_TessCoord.x, gl_TessCoord.y, (sin(time) + 1.0f) / 2.0f);

  gl_Position = projection_matrix * model_matrix * view_matrix * p;
}